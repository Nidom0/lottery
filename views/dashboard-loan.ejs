<%- include('partials/navbar', { currentPage: 'loan' }) %>
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>داشبورد وام</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    body { margin: 0; background: linear-gradient(135deg,#0d0f1b,#101326,#141a33,#0d1125); font-family: 'Vazirmatn', sans-serif; color: #f6f8ff; }
    .wrap { margin-top:100px; padding:24px; max-width:1400px; margin-inline:auto; }
    .glass { background: rgba(255,255,255,0.06); backdrop-filter: blur(18px); border:1px solid rgba(255,255,255,0.08); border-radius:18px; padding:24px; box-shadow:0 12px 30px rgba(0,0,0,0.45); margin-bottom:20px; }
    .title-row { display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; }
    .title-row h1 { margin:0; color:#7ec7ff; }
    .stat-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap:14px; margin-top:12px; }
    .stat { background: rgba(255,255,255,0.08); border-radius:14px; padding:16px; display:flex; align-items:center; justify-content:space-between; box-shadow:0 10px 22px rgba(0,0,0,0.35); }
    .stat .icon { font-size:38px; color:#6aa7ff; }
    .stat .number { font-size:28px; font-weight:700; }
    .panel-grid { display:grid; grid-template-columns: 2fr 1fr; gap:18px; margin-top:12px; }
    table { width: 100%; border-collapse: collapse; background: rgba(255,255,255,0.07); border-radius:14px; overflow:hidden; }
    th, td { padding:14px; text-align:center; }
    th { background: rgba(0,0,0,0.35); }
    tr:nth-child(even) td { background: rgba(255,255,255,0.03); }
    tr:hover td { background: rgba(255,255,255,0.08); }
    .badge { display:inline-block; padding:6px 10px; border-radius:10px; background:rgba(79,163,255,0.25); border:1px solid rgba(79,163,255,0.4); }
    .profile { background: rgba(255,255,255,0.07); border-radius:16px; padding:16px; border:1px solid rgba(255,255,255,0.12); }
    .profile h3 { margin-top:0; color:#a7d7ff; }
    .profile-row { display:flex; align-items:center; gap:12px; margin-bottom:8px; }
    .profile-row i { color:#6aa7ff; font-size:18px; }
    .timeline { display:grid; grid-template-columns: repeat(auto-fit,minmax(180px,1fr)); gap:10px; margin-top:10px; }
    .chip { background: rgba(255,255,255,0.06); padding:10px; border-radius:12px; border:1px solid rgba(255,255,255,0.12); text-align:center; }
    .btn-main { background: linear-gradient(135deg,#3a8bff,#6aa7ff); padding: 10px 18px; border-radius: 50px; color:#0b1022; font-weight:700; text-decoration:none; display:inline-flex; align-items:center; gap:8px; box-shadow:0 6px 20px rgba(90,150,255,0.4); }
    @media(max-width: 1100px){ .panel-grid { grid-template-columns:1fr; } }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="glass">
      <div class="title-row">
        <h1>داشبورد مدیریت وام</h1>
        <div style="display:flex; gap:10px; align-items:center;">
          <div class="badge">تاریخ امروز (شمسی): <%= persianDate %></div>
          <a class="btn-main" href="/loans/gold" target="_blank"><i class="bi bi-link-45deg"></i>مشاهده فرم متقاضی</a>
        </div>
      </div>
      <div class="stat-grid">
        <div class="stat">
          <div>
            <div style="opacity:.75;">پرونده‌های جدید</div>
            <div class="number"><%= pipeline[0].count %></div>
          </div>
          <i class="bi bi-hourglass-split icon"></i>
        </div>
        <div class="stat">
          <div>
            <div style="opacity:.75;">درحال بررسی</div>
            <div class="number"><%= pipeline[1].count %></div>
          </div>
          <i class="bi bi-search icon"></i>
        </div>
        <div class="stat">
          <div>
            <div style="opacity:.75;">تأیید شده</div>
            <div class="number"><%= pipeline[2].count %></div>
          </div>
          <i class="bi bi-patch-check icon"></i>
        </div>
        <div class="stat">
          <div>
            <div style="opacity:.75;">در انتظار پرداخت</div>
            <div class="number"><%= pipeline[3].count %></div>
          </div>
          <i class="bi bi-cash-coin icon"></i>
        </div>
      </div>
    </div>

    <div class="panel-grid">
      <div class="glass">
        <div class="title-row" style="margin-bottom:10px;">
          <h2 style="margin:0;">لیست متقاضیان</h2>
          <span style="opacity:.7;">نمایش آخرین درخواست‌های ثبت‌شده با جزئیات هویتی</span>
        </div>
        <table>
          <thead>
            <tr>
              <th>نام و نام خانوادگی</th>
              <th>مبلغ وام (تومان)</th>
              <th>تاریخ ایجاد (شمسی)</th>
              <th>شماره کارت</th>
              <th>وضعیت</th>
            </tr>
          </thead>
          <tbody>
            <% sampleApplicants.forEach(app => { %>
              <tr>
                <td><%= app.name %><div style="opacity:.7;font-size:12px;">کدملی: <%= app.nationalId %> | تلفن: <%= app.phone %></div></td>
                <td><%= app.amount %></td>
                <td><%= app.created %></td>
                <td><%= app.card %></td>
                <td><span class="badge"><%= app.status %></span></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>

      <div class="glass">
        <div class="profile">
          <h3>پروفایل آخرین متقاضی</h3>
          <% const last = sampleApplicants[0]; %>
          <div class="profile-row"><i class="bi bi-person"></i> <span><%= last.name %></span></div>
          <div class="profile-row"><i class="bi bi-upc-scan"></i> <span>کدملی: <%= last.nationalId %></span></div>
          <div class="profile-row"><i class="bi bi-telephone"></i> <span>تماس: <%= last.phone %></span></div>
          <div class="profile-row"><i class="bi bi-bank"></i> <span>بانک مقصد: <%= last.bank %></span></div>
          <div class="profile-row"><i class="bi bi-credit-card"></i> <span>کارت: <%= last.card %></span></div>
          <div class="profile-row"><i class="bi bi-cash-coin"></i> <span>مبلغ: <%= last.amount %> تومان</span></div>
          <div class="profile-row"><i class="bi bi-clock-history"></i> <span>ثبت: <%= last.created %></span></div>
          <div class="timeline">
            <div class="chip">بارگذاری مدارک</div>
            <div class="chip">امضای دیجیتال</div>
            <div class="chip">تایید هویت</div>
            <div class="chip">در انتظار پرداخت</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
