<%- include('partials/navbar') %>

<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title>داشبورد قرعه‌کشی</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<link href="https://fonts.googleapis.com/css2?family=Vazir:wght@300;400;700&display=swap" rel="stylesheet">

<style>
  body {
    margin: 0;
    background: linear-gradient(135deg,#0d0f1b,#101326,#141a33,#0d1125);
    font-family: Vazir;
    color: white;
  }

  .container {
    max-width: 1450px;
    margin: 120px auto;
    padding: 25px;
  }

  .glass {
    background: rgba(255,255,255,0.06);
    backdrop-filter: blur(18px);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 18px;
    padding: 25px;
    box-shadow: 0 12px 28px rgba(0,0,0,0.45);
    margin-bottom: 28px;
  }

  .clock-box { 
    display:flex; justify-content:space-between; 
    align-items:center;
    padding: 25px;
  }

  .clock-time {
    font-size: 42px;
    font-weight: 700;
    color: #4fa3ff;
  }

  .stats {
    display: flex;
    gap: 25px;
    margin-top: 20px;
  }

  .stat {
    flex: 1;
    background: rgba(255,255,255,0.08);
    padding: 25px;
    border-radius: 16px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    box-shadow: 0 12px 22px rgba(0,0,0,0.35);
  }

  .stat-icon {
    font-size: 48px;
    color: #6aa7ff;
  }

  .stat-label { opacity:.8; }
  .stat-number { font-size: 32px; font-weight: 700; }

  .btns {
    display:flex; gap:15px; margin-top:25px;
  }

  .btn-main {
    background: linear-gradient(135deg,#3a8bff,#6aa7ff);
    padding: 12px 24px;
    border-radius: 50px;
    color: #000;
    text-decoration:none;
    font-weight:700;
    cursor:pointer;
    box-shadow: 0 6px 20px rgba(90,150,255,0.4);
    transition:.25s;
  }

  .btn-main:hover { transform: translateY(-3px); }

  table {
    width: 100%;
    border-collapse: collapse;
    background: rgba(255,255,255,0.07);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    overflow: hidden;
    margin-top: 18px;
  }

  th {
    padding: 16px;
    background: rgba(0,0,0,0.35);
    font-weight:700;
  }

  td {
    padding: 14px;
    border-bottom: 1px solid rgba(255,255,255,0.08);
    text-align: center;
  }

  tr:hover { background: rgba(255,255,255,0.09); }

  .search-box {
    padding: 12px 18px;
    width: 260px;
    border-radius: 50px;
    border:none;
    background: rgba(255,255,255,0.12);
    color:white;
    margin-bottom:12px;
  }
</style>

</head>

<body>

<div class="container">

  <div class="glass clock-box">
    <div>
      <div style="font-size:18px; opacity:.7;">ساعت و تاریخ جاری</div>
      <div class="clock-time" id="clockTime">--:--:--</div>
      <div id="clockDate" style="opacity:.7; margin-top:5px;">---</div>
    </div>

    <i class="bi bi-clock-history" style="font-size:48px;color:#4fa3ff;"></i>
  </div>

  <div class="stats">

    <div class="stat">
      <div>
        <div class="stat-label">کل مشترکین</div>
        <div class="stat-number"><%= totalCustomers %></div>
      </div>
      <i class="bi bi-people stat-icon"></i>
    </div>

    <div class="stat">
      <div>
        <div class="stat-label">دیده شده</div>
        <div class="stat-number"><%= totalViewed %></div>
      </div>
      <i class="bi bi-eye stat-icon"></i>
    </div>

    <div class="stat">
      <div>
        <div class="stat-label">کل برندگان</div>
        <div class="stat-number"><%= totalWinners %></div>
      </div>
      <i class="bi bi-trophy stat-icon"></i>
    </div>

  </div>

  <div class="btns">
    <a href="/dashboard/lottery/create-winner" class="btn-main">ایجاد برنده</a>
    <a href="/template" class="btn-main" style="background:#7ef3ff;">ساخت تمپلیت</a>
    <a href="/dashboard/lottery/registration-codes" class="btn-main" style="background:#8affc1;">کدهای ثبت‌نام</a>

  </div>

  <input type="text" id="searchInput" placeholder="جستجو..." class="search-box">

  <table>
    <thead>
      <tr>
        <th>نام</th>
        <th>موبایل</th>
        <th>لینک</th>
        <th>کد ثبت‌نام</th>
        <th>مشاهده</th>
        <th>اطلاعات</th>
        <th>برنده</th>
        <th>تاریخ</th>
        <th>پروفایل</th>
      </tr>
    </thead>

    <tbody>
      <% winners.forEach(w => { %>
        <tr>
          <td><%= w.fullName %></td>
          <td><%= w.phone %></td>
          <td><div style="direction:ltr"><%= w.linkId %></div></td>
          <td><%= w.registrationCode || '—' %></td>

          <td>
            <% if(w.viewed) { %>
              <i class="bi bi-eye" style="color:#7ef3ff;"></i>
            <% } else { %>
              <i class="bi bi-eye-slash" style="color:#eee;"></i>
            <% } %>
          </td>

          <td>
            <% if(w.infoComplete) { %>
              <span style="color:#7ef3ff;">کامل</span>
            <% } else { %>
              <span style="color:#ff6262;">ناقص</span>
            <% } %>
          </td>

          <td>
            <% if(w.prize) { %>
              <span style="color:#7ef3ff;">برنده</span>
            <% } else { %>
              —
            <% } %>
          </td>

          <td><%= w.createdAt ? w.createdAt.toLocaleString("fa-IR") : "—" %></td>

          <td>
            <a href="/dashboard/lottery/profile/<%= w.id %>" class="btn-main" style="padding:6px 14px;">پروفایل</a>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>

</div>

<script>
function updateClock() {
  const now = new Date();
  document.getElementById("clockTime").innerText = now.toLocaleTimeString("fa-IR");
  document.getElementById("clockDate").innerText = now.toLocaleDateString("fa-IR",{weekday:"long",year:"numeric",month:"long",day:"numeric"});
}
setInterval(updateClock,1000); updateClock();
</script>

</body>
</html>
